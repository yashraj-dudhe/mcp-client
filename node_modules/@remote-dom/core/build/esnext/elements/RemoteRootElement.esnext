import { ROOT_ID, MUTATION_TYPE_INSERT_CHILD } from '../constants.esnext';
import { REMOTE_IDS, remoteConnection, connectRemoteNode, serializeRemoteNode, updateRemoteElementProperty, callRemoteElementMethod } from './internals.esnext';

class RemoteRootElement extends HTMLElement {
  constructor() {
    super();
    REMOTE_IDS.set(this, ROOT_ID);
  }
  connect(connection) {
    if (remoteConnection(this) === connection) return;
    connectRemoteNode(this, connection);
    if (this.childNodes.length === 0) return;
    const records = [];
    for (let i = 0; i < this.childNodes.length; i++) {
      const node = this.childNodes[i];
      records.push([
        MUTATION_TYPE_INSERT_CHILD,
        ROOT_ID,
        serializeRemoteNode(node),
        i
      ]);
    }
    connection.mutate(records);
  }
  updateRemoteProperty(name, value) {
    updateRemoteElementProperty(this, name, value);
  }
  callRemoteMethod(method, ...args) {
    return callRemoteElementMethod(this, method, ...args);
  }
}

export { RemoteRootElement };
